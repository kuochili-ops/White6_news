<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ğ“ƒ¥ ç™½å…­æ—¥å ± - æ¸¬è©¦ç‰ˆ</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <style>
        body { background: #1a1a1a; color: white; display: flex; flex-direction: column; align-items: center; padding-top: 50px; font-family: sans-serif; }
        
        /* æ¸¬è©¦ç”¨çš„è¶…å¤§åŸç”ŸæŒ‰éˆ• */
        .test-input { 
            width: 90%; 
            height: 100px; 
            font-size: 20px; 
            background: white; 
            color: black; 
            border: 5px solid #f39c12; 
            border-radius: 15px;
            margin-bottom: 30px;
        }

        #editor-ui { display: none; width: 90%; text-align: center; border-top: 1px solid #555; padding-top: 20px; }
        .viewport { width: 150px; height: 150px; border: 2px solid #fff; margin: 10px auto; overflow: hidden; position: relative; background: #000; }
        .sync-img { position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); }
        .btn-pub { background: #27ae60; color: white; padding: 20px; width: 100%; border: none; font-size: 1.2rem; font-weight: bold; border-radius: 10px; margin-top: 20px; }
    </style>
</head>
<body>

    <h2>æ­¥é©Ÿ 1ï¼šé»æ“Šä¸‹æ–¹å¤§æŒ‰éˆ•</h2>
    <input type="file" id="upload" accept="image/*" class="test-input">

    <div id="editor-ui">
        <h2>æ­¥é©Ÿ 2ï¼šèª¿æ•´ä¸¦ç™¼å¸ƒ</h2>
        <div class="viewport" id="viewport">
            <img id="raw-img" class="sync-img" src="">
        </div>
        <input type="range" id="zoom-ctrl" min="0.1" max="3" step="0.01" value="1" style="width: 80%;">
        <br><br>
        <button class="btn-pub" onclick="uploadToGithub()">ç¢ºå®šåˆŠå°ç™¼å¸ƒ</button>
    </div>

    <script>
        const TK_PARTS = ["ghp_CbTbFJpfe9j2u0ER", "U80NwlkHv5NJVQ23vKXE"];
        const GH_CONFIG = { owner: "kuochili-ops", repo: "White6_news", path: "images/daily.jpg" };

        const uploadInput = document.getElementById('upload');
        const editorUi = document.getElementById('editor-ui');
        const rawImg = document.getElementById('raw-img');

        // ç›£è½æœ€åŸå§‹çš„è®ŠåŒ–äº‹ä»¶
        uploadInput.addEventListener('change', function(e) {
            if (e.target.files && e.target.files[0]) {
                const reader = new FileReader();
                reader.onload = function(ev) {
                    rawImg.src = ev.target.result;
                    editorUi.style.display = 'block'; // åªæœ‰é¸äº†ç…§ç‰‡æ‰é¡¯ç¤ºå¾ŒçºŒæ“ä½œ
                };
                reader.readAsDataURL(e.target.files[0]);
            }
        });

        async function uploadToGithub() {
            const btn = event.target;
            btn.innerText = "â³ ç™¼å¸ƒä¸­...";
            try {
                const canvas = await html2canvas(document.getElementById('viewport'), { useCORS: true });
                const base64Data = canvas.toDataURL("image/jpeg", 0.8).split(",")[1];
                const url = `https://api.github.com/repos/${GH_CONFIG.owner}/${GH_CONFIG.repo}/contents/${GH_CONFIG.path}`;
                const headers = { "Authorization": `token ${TK_PARTS.join('')}`, "Content-Type": "application/json" };
                const getRes = await fetch(url);
                let sha = getRes.ok ? (await getRes.json()).sha : null;
                const putRes = await fetch(url, { method: "PUT", headers, body: JSON.stringify({ message: "Update", content: base64Data, sha }) });
                if (putRes.ok) { alert("âœ… åˆŠå°æˆåŠŸï¼"); location.reload(); }
            } catch (e) { alert("éŒ¯èª¤"); btn.innerText = "ç¢ºå®šåˆŠå°ç™¼å¸ƒ"; }
        }
    </script>
</body>
</html>
