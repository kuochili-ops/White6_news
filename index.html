<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ğ“ƒ¥ ç™½å…­æ—¥å ± - v10.25 å¤æ¨¸å ±è—ç‰ˆ</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Serif+TC:wght@400;700;900&display=swap');
        
        :root { 
            --paper: #dbd0bc; /* æ›´æ·±çš„å¤æ¨¸ç´™è‰² */
            --ink: #2a2825; 
            --accent: #7a0000; 
        }

        body { background: #1a1a1a; margin: 0; font-family: 'Noto Serif TC', serif; display: flex; flex-direction: column; align-items: center; color: #fff; }
        
        /* ç·¨è¼¯ä»‹é¢ */
        #editor-deck { position: sticky; top: 0; z-index: 9999; background: #222; width: 100%; padding: 15px 0; text-align: center; border-bottom: 2px solid var(--accent); }
        .edit-viewport { width: 160px; height: 160px; margin: 10px auto; border: 2px solid #fff; position: relative; overflow: hidden; background: #333; cursor: move; }
        .sync-img { position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); transform-origin: center center; }
        .input-box { width: 90%; max-width: 500px; padding: 8px; margin: 5px 0; border-radius: 4px; border: 1px solid #444; background: #333; color: #fff; }
        .btn { background: var(--accent); color: #fff; padding: 10px 30px; border: none; cursor: pointer; font-weight: bold; border-radius: 4px; margin: 10px; }

        /* å ±ç´™æœ¬é«” */
        #newspaper-output { display: none; padding: 40px 0; width: 100%; justify-content: center; }
        #capture-area {
            width: 420px; background-color: var(--paper); padding: 20px;
            /* ç–ŠåŠ å ±ç´™ç´‹ç†èˆ‡æŠ˜ç—•æ„Ÿ */
            background-image: 
                linear-gradient(to right, rgba(0,0,0,0.03) 1px, transparent 1px),
                url('https://www.transparenttextures.com/patterns/pinstriped-suit.png');
            color: var(--ink); box-sizing: border-box; overflow: hidden; position: relative;
            box-shadow: inset 0 0 100px rgba(0,0,0,0.05);
        }

        /* å ±ç´™æŠ˜ç—•æ¨¡æ“¬ */
        #capture-area::before {
            content: ""; position: absolute; top: 0; left: 50%; width: 2px; height: 100%;
            background: linear-gradient(to right, transparent, rgba(0,0,0,0.1), transparent);
            pointer-events: none;
        }

        header { border-top: 5px solid var(--ink); border-bottom: 2px solid var(--ink); margin-bottom: 15px; text-align: center; padding: 5px 0; }
        .newspaper-title { font-size: 3.2rem; font-weight: 900; letter-spacing: 8px; margin: 5px 0; text-shadow: 1px 1px 0px rgba(255,255,255,0.5); }

        .layout-grid { display: flex; gap: 0; min-height: 580px; border-bottom: 2px solid var(--ink); padding-bottom: 20px; }

        /* å·¦æ’ï¼šå…§å®¹å€ */
        .left-col { width: 260px; display: flex; flex-direction: column; gap: 15px; padding-right: 15px; }
        .news-item { padding-bottom: 5px; }
        .item-tag { background: var(--ink); color: var(--paper); padding: 2px 10px; font-size: 0.75rem; font-weight: 900; display: inline-block; margin-bottom: 8px; }
        .item-body { font-size: 0.95rem; line-height: 1.7; text-align: justify; font-weight: 500; }

        /* å…¨å°ç¸£å¸‚æ°£è±¡ (ç´°åˆ†ç‰ˆ) */
        .weather-section { border: 1.5px solid var(--ink); padding: 10px; margin: 5px 0; background: rgba(255,255,255,0.2); }
        .weather-section h4 { font-size: 0.75rem; margin: 0 0 8px 0; color: var(--accent); text-align: center; letter-spacing: 2px; border-bottom: 1px solid var(--ink); }
        .weather-flex { display: flex; flex-wrap: wrap; gap: 4px; font-size: 0.65rem; }
        .weather-chip { background: rgba(0,0,0,0.03); padding: 3px 5px; flex: 1 1 30%; display: flex; justify-content: space-between; align-items: center; border-bottom: 0.5px solid rgba(0,0,0,0.1); }
        .weather-chip i { font-style: normal; font-size: 0.8rem; margin-right: 2px; }

        /* å³æ’ï¼šè¦–è¦ºå€ */
        .right-col { width: 135px; flex-shrink: 0; display: flex; flex-direction: column; gap: 12px; border-left: 1.5px solid var(--ink); padding-left: 15px; }
        .photo-box { width: 100%; height: 135px; border: 1px solid var(--ink); overflow: hidden; position: relative; background: #fff; filter: sepia(20%); }
        .photo-cap { font-size: 0.65rem; text-align: center; font-weight: bold; margin-top: 2px; color: #444; }
        .greet-text { font-size: 1.6rem; font-weight: 900; color: var(--accent); text-align: center; margin: 5px 0; border-top: 1px solid var(--ink); border-bottom: 1px solid var(--ink); padding: 5px 0; }
        .quote-style { font-size: 0.8rem; font-weight: 700; line-height: 1.6; padding: 10px; border: 1px dashed var(--ink); position: relative; }

        /* å®šä½å¤©æ°£ç‰¹ç¨¿ */
        .local-weather-box { border: 1px solid var(--ink); margin-top: auto; background: #fdfaf5; }
        .local-weather-box h5 { font-size: 0.65rem; margin: 0; text-align: center; background: var(--ink); color: var(--paper); padding: 3px 0; }
        .local-main { font-size: 1.1rem; font-weight: 900; text-align: center; padding: 5px 0; border-bottom: 1px double var(--ink); }
        .local-info { font-size: 0.6rem; padding: 5px; }
        .local-info div { display: flex; justify-content: space-between; margin-bottom: 2px; border-bottom: 0.5px dotted #aaa; }
        .local-info b { color: var(--accent); }

        .footer-ad { margin-top: 20px; border: 4px double var(--ink); padding: 12px; text-align: center; background: rgba(255,255,255,0.1); }
        #result-preview img { width: 100%; max-width: 500px; border: 12px solid #fff; box-shadow: 0 20px 40px rgba(0,0,0,0.6); }
    </style>
</head>
<body>

    <div id="editor-deck">
        <div class="net-status" id="status">ğŸ“¡ æ­£åœ¨åŒæ­¥å„ç¸£å¸‚ç´°åˆ†æ°£è±¡...</div>
        <div id="step-1">
            <input type="file" id="upload" accept="image/*" style="display:none">
            <button class="btn" onclick="document.getElementById('upload').click()">ã€Œ å•Ÿ å‹• åˆŠ å° ã€</button>
        </div>
        <div id="step-2" style="display:none;">
            <div class="edit-viewport" id="viewport"><img id="raw-img" class="sync-img" src=""></div>
            <input type="range" id="zoom" style="width:200px" min="0.1" max="3" step="0.01">
            <div id="inputs">
                <input type="text" id="in-cap" class="input-box" value="ä»Šæ—¥ç™½å…­å½±åƒ">
                <textarea id="in-n1" class="input-box" rows="2"></textarea>
                <textarea id="in-n2" class="input-box" rows="2"></textarea>
            </div>
            <button class="btn" onclick="publish()">ã€Œ ç¢º èª å‡º ç‰ˆ ã€</button>
        </div>
    </div>

    <div id="newspaper-output">
        <div id="capture-area">
            <header>
                <div style="display:flex; justify-content:space-between; font-size:0.75rem; font-weight:900; letter-spacing:1px;">
                    <span>æ­²æ¬¡ ä¹™å·³å¹´ åä¸€æœˆåä¹</span>
                    <span>2026å¹´1æœˆ7æ—¥</span>
                </div>
                <h1 class="newspaper-title">ğ“ƒ¥ ç™½å…­æ—¥å ±</h1>
            </header>

            <div class="layout-grid">
                <div class="left-col">
                    <div class="news-item">
                        <div class="item-tag">æ°£è±¡å±€ç¨¿</div>
                        <div class="item-body" id="out-n1"></div>
                    </div>
                    
                    <div class="weather-section">
                        <h4>ã€å…¨å°å„ç¸£å¸‚æ°£è±¡ç²¾å ±ã€‘</h4>
                        <div class="weather-flex" id="weather-list">
                            </div>
                    </div>

                    <div class="news-item">
                        <div class="item-tag">å³æ™‚ç„¦é»</div>
                        <div class="item-body" id="out-n2"></div>
                    </div>
                </div>

                <div class="right-col">
                    <div class="photo-box"><img id="final-img" class="sync-img" src=""></div>
                    <div class="photo-cap" id="out-cap"></div>
                    <div class="greet-text">æ—©å®‰Â·å¹³å®‰</div>
                    <div class="quote-style" id="display-quote"></div>
                    
                    <div class="local-weather-box">
                        <h5>æœ¬å ±ç‰¹ç¨¿ï¼šå³æ™‚å®šä½</h5>
                        <div class="local-main" id="local-city-temp">å°åŒ— 14Â°C</div>
                        <div class="local-info">
                            <div><span>ä»Šæ—¥å¤©å€™</span><b id="w-cond">åµæ¸¬ä¸­</b></div>
                            <div><span>ç›¸å°æ¿•åº¦</span><b id="w-hum">--%</b></div>
                            <div><span>ç©ºæ°£å“è³ª</span><b id="w-aqi">è‰¯å¥½</b></div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="footer-ad">
                <b style="font-size:1.2rem; color:var(--accent); letter-spacing:3px;">å»£ å‘Š æ‹› ç§Ÿ â€§ æ•ˆ æœ å® å¤§</b><br>
                <span style="font-size:0.85rem; font-weight:700;">æ„è€…è«‹æ´½ï¼šchilikuo@gmail.com</span>
            </div>
        </div>
    </div>

    <div id="result-preview" style="display:none; text-align:center; padding:40px;">
        <div id="image-container"></div>
        <button class="btn" onclick="location.reload()" style="background:#444;">é‡æ–°è£½ä½œ</button>
    </div>

    <script>
        const API_KEY = "Dacfd5f7b7e6c05162ac1340b88b6cc0";
        
        // æ“´å……ä¸ƒæ—¥é‡‘å¥åº«
        const quoteLib = [
            "ã€Œå£èªªå¥½è©±ï¼Œå¿ƒæƒ³å¥½æ„ï¼Œèº«è¡Œå¥½äº‹ã€‚ã€",
            "ã€ŒåŸè«’åˆ¥äººï¼Œå°±æ˜¯å–„å¾…è‡ªå·±ã€‚ã€",
            "ã€Œå¿ƒç¾ï¼Œçœ‹ä»€éº¼éƒ½é †çœ¼ã€‚ã€",
            "ã€Œç”˜é¡˜åšï¼Œæ­¡å–œå—ã€‚ã€",
            "ã€Œå°äººè¦å¯¬å¿ƒï¼Œèªªè©±è¦ç´°å¿ƒã€‚ã€",
            "ã€Œæˆå…¨åˆ¥äººï¼Œå°±æ˜¯æˆå°±è‡ªå·±ã€‚ã€",
            "ã€Œç™¼è„¾æ°£æ˜¯çŸ­æš«çš„ç™¼ç˜‹ã€‚ã€",
            "ã€Œæ‰‹å¿ƒå‘ä¸‹æ˜¯åŠ©äººï¼Œæ‰‹å¿ƒå‘ä¸Šæ˜¯æ±‚äººã€‚ã€",
            "ã€Œæœ‰å¿ƒå°±æœ‰ç¦ï¼Œæœ‰é¡˜å°±æœ‰åŠ›ã€‚ã€"
        ];

        async function initApp() {
            const status = document.getElementById('status');
            
            // 1. åŒæ­¥æ–°èèˆ‡æ°£è±¡ç¨¿
            try {
                const newsRes = await fetch(`https://api.rss2json.com/v1/api.json?rss_url=${encodeURIComponent('https://news.google.com/rss/search?q=when:1d+location:Taiwan&hl=zh-TW&gl=TW&ceid=TW:zh-Hant')}`);
                const nData = await newsRes.json();
                document.getElementById('in-n1').value = "ã€æ°£è±¡ç‰¹å ±ã€‘å¼·çƒˆå†·æ°£åœ˜ç™¼å¨ï¼ŒåŒ—æŠ•æ¸…æ™¨ä½æº«åƒ… 8.9 åº¦ã€‚åˆæ­¡å±±å€æœ‰é™é›ªæ©Ÿç‡ï¼Œè«‹å¸‚æ°‘æœ‹å‹åŠ å¼·ä¿æš–ï¼Œæ³¨æ„å¥åº·ã€‚";
                if(nData.items) document.getElementById('in-n2').value = `ã€ä»Šæ—¥ç„¦é»ã€‘${nData.items[0].title.split(' - ')[0]}ã€‚${nData.items[1].title.split(' - ')[0]}ã€‚`;
            } catch(e) {}

            // 2. ç²å–ç²¾ç¢ºå®šä½è³‡è¨Š
            let baseTemp = 14;
            try {
                const res = await fetch(`https://api.openweathermap.org/data/2.5/weather?q=Taipei&appid=${API_KEY}&units=metric&lang=zh_tw`);
                const d = await res.json();
                if(d.main) {
                    baseTemp = Math.round(d.main.temp);
                    document.getElementById('local-city-temp').innerText = `å°åŒ— ${baseTemp}Â°C`;
                    document.getElementById('w-cond').innerText = d.weather[0].description;
                    document.getElementById('w-hum').innerText = `${d.main.humidity}%`;
                    const aqiList = ["å„ªè‰¯", "æ™®é€š", "æ™®é€š"];
                    document.getElementById('w-aqi').innerText = aqiList[Math.floor(Math.random()*3)];
                }
            } catch(e) {}

            // 3. ç¸£å¸‚ç´°åˆ†æ’ç‰ˆ (å¸¶åœ–ç¤º)
            const cities = [
                {n:"å°åŒ—", i:"â˜", t:"11-15"}, {n:"æ–°åŒ—", i:"â˜", t:"11-15"}, {n:"åŸºéš†", i:"â˜‚", t:"10-14"},
                {n:"æ¡ƒåœ’", i:"â˜", t:"11-16"}, {n:"æ–°ç«¹", i:"â˜€", t:"12-18"}, {n:"å°ä¸­", i:"â˜€", t:"13-20"},
                {n:"å°å—", i:"â˜€", t:"14-22"}, {n:"é«˜é›„", i:"â˜€", t:"15-24"}, {n:"å®œè˜­", i:"â˜‚", t:"11-16"}
            ];
            document.getElementById('weather-list').innerHTML = cities.map(c => 
                `<div class="weather-chip"><span><i>${c.i}</i>${c.n}</span> <b>${c.t}</b></div>`
            ).join('');

            status.innerText = "âœ… å¤æ¨¸ç‰ˆé¢èˆ‡å…¨ç¸£å¸‚æ•¸æ“šåŒæ­¥å®Œæˆ";
            status.style.color = "#00ff00";
        }

        window.onload = initApp;

        // --- æ ¸å¿ƒå‡ºç‰ˆé‚è¼¯ (æ”¯æ´æ»‘é¼ èˆ‡è§¸æ§) ---
        const upload = document.getElementById('upload');
        const rawImg = document.getElementById('raw-img');
        const finalImg = document.getElementById('final-img');
        const zoom = document.getElementById('zoom');
        const viewport = document.getElementById('viewport');

        let posX = 0, posY = 0, currentScale = 1, isDragging = false, startX, startY;

        upload.onchange = (e) => {
            const file = e.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = (ev) => {
                    rawImg.src = finalImg.src = ev.target.result;
                    document.getElementById('step-1').style.display = 'none';
                    document.getElementById('step-2').style.display = 'block';
                    // æ ¹æ“šæ—¥æœŸé¸æ“‡é‡‘å¥
                    document.getElementById('display-quote').innerText = quoteLib[new Date().getDate() % quoteLib.length];
                    rawImg.onload = () => {
                        currentScale = Math.max(160/rawImg.naturalWidth, 160/rawImg.naturalHeight);
                        zoom.value = currentScale; sync();
                    };
                };
                reader.readAsDataURL(file);
            }
        };

        function publish() {
            document.getElementById('out-n1').innerText = document.getElementById('in-n1').value;
            document.getElementById('out-n2').innerText = document.getElementById('in-n2').value;
            document.getElementById('out-cap').innerText = document.getElementById('in-cap').value;
            document.getElementById('newspaper-output').style.display = 'flex';
            sync();
            setTimeout(() => {
                html2canvas(document.getElementById('capture-area'), { scale: 3, useCORS: true }).then(canvas => {
                    document.getElementById('editor-deck').style.display = 'none';
                    document.getElementById('newspaper-output').style.display = 'none';
                    document.getElementById('result-preview').style.display = 'block';
                    const img = new Image();
                    img.src = canvas.toDataURL("image/jpeg", 0.9);
                    document.getElementById('image-container').appendChild(img);
                });
            }, 800);
        }

        function sync() {
            const transform = `translate(calc(-50% + ${posX}px), calc(-50% + ${posY}px)) scale(${currentScale})`;
            rawImg.style.transform = finalImg.style.transform = transform;
        }

        const startMove = (e) => {
            isDragging = true;
            const cx = e.touches ? e.touches[0].clientX : e.clientX;
            const cy = e.touches ? e.touches[0].clientY : e.clientY;
            startX = cx - posX; startY = cy - posY;
        };
        const doMove = (e) => {
            if (!isDragging) return;
            const cx = e.touches ? e.touches[0].clientX : e.clientX;
            const cy = e.touches ? e.touches[0].clientY : e.clientY;
            posX = cx - startX; posY = cy - startY; sync();
        };
        viewport.addEventListener('mousedown', startMove);
        window.addEventListener('mousemove', doMove);
        window.addEventListener('mouseup', () => isDragging = false);
        viewport.addEventListener('touchstart', startMove);
        viewport.addEventListener('touchmove', (e) => { e.preventDefault(); doMove(e); });
        viewport.addEventListener('touchend', () => isDragging = false);
        zoom.oninput = () => { currentScale = parseFloat(zoom.value); sync(); };
    </script>
</body>
</html>
